    <!-- Tab Navigation -->
    <header class="window-header wb-general-header">
            <nav class="tabs" data-group="worldbuilder-tabs">
                <a class="item active" data-tab="main">
                <i class="fas fa-globe"></i>
                Main
                </a>
                <a class="item" data-tab="lairs">
                <i class="fas fa-dungeon"></i>
                Lairs
                </a>
                <a class="item" data-tab="towns">
                <i class="fas fa-castle"></i>
                Towns
                </a>
                <a class="item" data-tab="treasure">
                <i class="fas fa-gem"></i>
                Treasure
                </a>
                <a class="item" data-tab="magic-items">
                <i class="fas fa-hat-wizard"></i>
                Magic Items
                </a>
                <a class="item" data-tab="traps">
                <i class="fas fa-skull-crossbones"></i>
                Traps
                </a>
                <a class="item" data-tab="actors">
                <i class="fas fa-users"></i>
                Actors
                </a>
            </nav>
        <div class="tab-separator"></div>
    </header>

<form>
  <!-- TAB CONTENT-->

  <!-- MAIN TAB -->
  <section class="tab-content" data-tab="main">

          <div class="wb-page-container scrollable-container">
          <h3>Main</h3>

            <div>
                <label for="population-density-select">Population Density:</label>
                <select class="population-density-select" name="population-density">
                {{#each populationDensityOptions}}
                <option value="{{this.value}}" {{#if (eq ../populationDensity this.value)}}selected{{/if}}>{{this.label}}</option>
                {{/each}}
                </select>
            </div>

            <div>
                <label for="climate-select">Climate Type:</label>
                <select class="climate-select" name="climate-type">
                {{#each climateTypeOptions}}
                <option value="{{this.value}}" {{#if (eq ../climateType this.value)}}selected{{/if}}>{{this.label}}</option>
                {{/each}}
                </select>
            </div>

                <table class="icon-button-table">
                    <tr>
                        <td>
                        <button type="button" class="icon-button terrain-roll" title="Roll for Terrain">
                        <i class="fas fa-dice"></i>
                        </button>
                        </td>
                        <td>
                        <button type="button" class="icon-button feature-type-roll" title="Roll for Feature Type">
                        <i class="fa-solid fa-dice-d20"></i>
                        </button>
                        </td>
                        <td>
                        <button type="button" class="icon-button encounter-roll" title="Roll for Encounter">
                        <i class="fas fa-dice-d10"></i><i class="fas fa-dice-d10"></i>
                        </button>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align: center;">Terrain</td>
                        <td style="text-align: center;">Feature Type</td>
                        <td style="text-align: center;">Encounter</td>
                    </tr>
                </table>

                <div class="form-group">
                    <label for="terrain-select">Terrain Type</label>
                    <select class="terrain-select" name="terrain-select">
                        {{#each terrainTypeOptions}}
                        <option value="{{this.value}}" {{#if (eq ../terrainType this.value)}}selected{{/if}}>
                        {{this.label}}
                        </option>
                        {{/each}}
                    </select>
                </div>

                <div class="form-group">
                    <label for="feature-type-select">Feature Type</label>
                    <select class="feature-type-select" name="feature-type-select">
                        {{#each featureTypeOptions}}
                        <option value="{{this.value}}" {{#if (eq ../featureType this.value)}}selected{{/if}}>{{this.label}}</option>
                        {{/each}}
                    </select>
                </div>

                <div class="form-group">
                    <label for="sub-feature-type-select">Sub-Feature Type</label>
                    <select class="sub-feature-type-select" name="sub-feature-type-select" {{#if subFeatureTypeOptions.length}} {{else}} disabled{{/if}}>
                        {{#each subFeatureTypeOptions}}
                        <option value="{{this.value}}" {{#if (eq ../subFeatureType this.value)}}selected{{/if}}>{{this.label}}</option>
                        {{/each}}
                    </select>
                </div>

                <div class="form-group">
                    <table class="terrain-info-table">
                    <thead>
                        <tr>
                            <td style="text-align: center;">Selected Terrain</td>
                            <td style="text-align: center;">Ruggedness</td>
                            <td style="text-align: center;">Travel Time</td>
                            <td style="text-align: center;">Encounter Frequency</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="text-align: center;">{{terrainType}}</td>
                            <td style="text-align: center;">{{ruggedness}}</td>
                            <td style="text-align: center;">{{travelTime}}</td>
                            <td style="text-align: center;">{{encounterFrequency}}</td>
                        </tr>
                    </tbody>
                    </table>
                </div>

                {{#if encounterResult}}
                <div class="form-group">
                    <table class="encounter-info-table">
                    <thead>
                        <tr>
                        <th>Encounter Result</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>{{{encounterResult}}}</td>
                        </tr>
                    </tbody>
                    </table>
                </div>
                {{/if}}

                <div class="form-group feature-type-section">
                    <table class="feature-info-table">
                    <thead>
                        <tr>
                        <th>Feature Type</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>
                            {{#if featureType}}{{featureType}}{{else}}No Feature Selected. Please select a feature type.{{/if}}
                            </td>
                        </tr>
                    </tbody>
                    </table>
                </div>

                <div class="form-group feature-details-section">
                    <table class="feature-info-table">
                    <thead>
                        <tr>
                        <th colspan="2">{{#if featureDetails.title}}{{featureDetails.title}}{{else}}Feature Details{{/if}}</th>
                        </tr>
                    </thead>
                        <tbody>
                        {{#if featureDetails.results}}
                        {{#each featureDetails.results}}
                        <tr>
                            <td>{{this}}</td>
                        </tr>
                        {{/each}}
                        {{else}}
                        <tr>
                            <td colspan="2">No details available. Select a sub-feature to view details.</td>
                        </tr>
                        {{/if}}
                        </tbody>
                    </table>
                </div>

          </div>

      </div>
  </section>


  <!-- LAIRS TAB -->
  <section class="tab-content wb-page-container" data-tab="lairs" style="display: none;">
  <h3>Lairs</h3>
  <button class="add-room">Add Room/Corridor</button>
      <div class="room-list">
      {{#each lairRooms}}

          <div class="room-entry">
              <h4 class="wb-header collapsible {{#if this.collapsed}}collapsed{{/if}}" data-index="{{@index}}">
              Room {{@index}}
              </h4>

              <div class="room-details" style="display: {{#if this.collapsed}}none{{else}}block{{/if}};">
                  <label for="lair-room-description-{{@index}}">Description</label>
                  <textarea id="lair-room-description-{{@index}}" class="lair-room-description" data-index="{{@index}}">
                      {{this.lairRoomDescription}}
                  </textarea>
                  <label for="lair-room-notes-{{@index}}">Notes</label>
                  <textarea id="lair-room-notes-{{@index}}" class="lair-room-notes" data-index="{{@index}}">
                      {{this.lairRoomNotes}}
                  </textarea>
                  <label for="lair-room-secrets-{{@index}}">Secrets</label>
                  <textarea id="lair-room-secrets-{{@index}}" class="lair-room-secrets" data-index="{{@index}}">
                      {{this.lairRoomSecrets}}
                  </textarea>
                  <label for="features-select">Features</label>
                  <select class="features-select" data-index="{{@index}}">
                      {{#each ../../featureOptions}}
                      <option value="{{this}}" {{#if (eq ../features.[0] this)}}selected{{/if}}>{{this}}</option>
                      {{/each}}
                  </select>
                  
                  <div class="encounter-section">
                      <label for="encounters-select-{{@index}}">Encounters</label>
                      
                      <div class="encounters-container" data-index="{{@index}}">
                          <table class="encounters-table">
                              <thead>
                              <tr>
                                  <th></th>
                                  <th>Encounter Stat Block</th>
                                  <th></th>
                                  <th></th>
                              </tr>
                              </thead>
                              <tbody>
                              {{#each this.encounters}}
                              <tr>
                                  <td>
                                  <select class="encounters-select" data-encounter-index="{{@index}}">
                                  {{#each ../../encounterOptions}}
                                  <option value="{{this}}" {{#if (eq ../result this)}}selected{{/if}}>{{this}}</option>
                                  {{/each}}
                                  </select>
                                  </td>
                                  <td class="encounter-statblock">
                                  {{{this.statblock}}}
                                  </td>
                                  <td>
                                  <button class="randomize-encounter" title="Randomize">
                                  <i class="fa fa-random"></i>
                                  </td>
                                  </button>
                                  <td>
                                  <button class="remove-encounter" title="Remove">
                                  <i class="fa fa-trash"></i>
                                  </button>
                                  </td>
                              </tr>
                              {{/each}}
                              </tbody>
                          </table>
                          <button class="add-encounter">Add Encounter</button>
                      </div>
                      
                  </div>

                  <button class="randomize-trap">Randomize</button>
                  <button class="trap-builder">Open Trap Builder</button>
                  
                  <div class="treasure-section">
                  <label for="treasure-category-select-{{@index}}">Treasure Category</label>
                      
                      <div class="treasure-container" data-index="{{@index}}">
                      <table class="treasure-table">
                          <thead>
                          <tr>
                              <th>Category</th>
                              <th>Item</th>
                              <th>Description</th>
                              <th></th>
                              <th></th>
                          </tr>
                          </thead>
                          <tbody>
                          {{#each this.treasure}}
                          <tr>
                              <td>
                              <select class="treasure-category-select" data-treasure-index="{{@index}}">
                                  <option value="" disabled {{#if (eq ../selectedCategory "")}}selected{{/if}}>Make selection</option>
                                  {{#each ../../lairTreasureOptions as |items category|}}
                                  <option value="{{category}}" {{#if (eq ../selectedCategory category)}}selected{{/if}}>{{category}}</option>
                                  {{/each}}
                              </select>
                              </td>
                              <td>
                              <select class="treasure-item-select" data-treasure-index="{{@index}}">
                                  <option value="" disabled {{#if (eq ../result "")}}selected{{/if}}>Make selection</option>
                                  {{#if ../../lairTreasureOptions.[../selectedCategory]}}
                                  {{#each ../../lairTreasureOptions.[../selectedCategory] as |item|}}
                                  <option value="{{item.id}}" {{#if (eq ../result item.id)}}selected{{/if}}>{{item.name}}</option>
                                  {{/each}}
                                  {{else}}
                                  <option value="" disabled>No items available</option>
                                  {{/if}}
                              </select>
                              </td>
                              <td class="treasure-details" data-treasure-index="{{@index}}">
                              <span>Quantity: {{../quantity}}</span><br>
                              <span>Cost: {{../cost}} {{../currencyType}}</span><br>
                              <span>XP Value: {{../xpValue}}</span>
                              </td>
                              <td>
                              <button class="randomize-treasure" title="Randomize">
                              <i class="fa fa-random"></i>
                              </button>
                              </td>
                              <td>
                              <button class="remove-treasure" title="Remove">
                              <i class="fa fa-trash"></i>
                              </button>
                              </td>
                          </tr>
                          </tr>
                          {{/each}}
                          </tbody>
                      </table>
                      </div>

                      <button class="add-treasure">Add Treasure</button>

                </div>
            </div>
          </div>
      {{/each}}
      </div>
  </section>


  <!-- SETTLEMENT TAB -->
  <section class="tab-content" data-tab="towns" style="display: none;">
  <h3>Towns</h3>
  <button class="add-town">Add Town</button>

      <div class="town-list">
      {{#each towns}}

          <div class="town-entry">
          <h4>Town {{@index}}</h4>
              <textarea class="town-description" placeholder="Description">{{this.description}}</textarea>
              <textarea class="town-notes" placeholder="Notes">{{this.notes}}</textarea>
              <label for="town-features-select">Features</label>
              <select class="town-features-select">
                  {{#each townFeaturesOptions}}
                  <option value="{{this}}">{{this}}</option>
                  {{/each}}
              </select>
              <button class="randomize-town-feature">Randomize</button>
          </div>

      {{/each}}
      </div>

  </section>


  <!-- TREASURE TAB-->
  <section class="tab-content" data-tab="treasure" style="display: none;">
      <h3>Treasure</h3>
      <button class="add-treasure">Add Treasure</button>

      <div class="treasure-list">
      {{#each treasures}}
          <div class="treasure-entry">
          <h4>Treasure {{@index}}</h4>
              <textarea class="treasure-description" placeholder="Description">{{this.description}}</textarea>
              <button class="randomize-treasure">Randomize</button>
              <button class="treasure-builder">Open Treasure Builder</button>
          </div>
      {{/each}}
      </div>

  </section>


  <!-- MAGIC ITEM TAB -->
  <section class="tab-content" data-tab="magic-items" style="display: none;">
  <h3>Magic Items</h3>
  <button class="add-magic-item">Add Magic Item</button>

      <div class="magic-item-list">
      {{#each magicItems}}

          <div class="magic-item-entry">
          <h4>Magic Item {{@index}}</h4>

                  <select class="magic-item-type-select" data-index="{{@index}}">
                      <option value="" disabled {{#unless this.type}}selected{{/unless}}>Select a Magic Item Type</option>
                      <option value="Magic Armor" {{#if (eq this.type "Magic Armor")}}selected{{/if}}>Magic Armor</option>
                      <option value="Magic Weapons" {{#if (eq this.type "Magic Weapons")}}selected{{/if}}>Magic Weapons</option>
                      <option value="Potions" {{#if (eq this.type "Potions")}}selected{{/if}}>Potions</option>
                      <option value="Scrolls" {{#if (eq this.type "Scrolls")}}selected{{/if}}>Scrolls</option>
                      <option value="Wands" {{#if (eq this.type "Wands")}}selected{{/if}}>Wands</option>
                      <option value="Magic Misc" {{#if (eq this.type "Magic Misc")}}selected{{/if}}>Magic Misc</option>
                  </select>

              <div class="magic-item-generator-content" data-index="{{@index}}"></div>

          </div>

      {{/each}}
      </div>

  </section>


  <!-- TRAPS TAB -->
  <section class="tab-content" data-tab="traps" style="display: none;">
      <h3>Traps</h3>
      <button class="add-trap">Add Trap</button>

      <div class="trap-list">
      {{#each traps}}

          <div class="trap-entry">
              <h4>Trap {{@index}}</h4>
              <textarea class="trap-description" placeholder="Description">{{this.description}}</textarea>
              <button class="randomize-trap">Randomize</button>
              <button class="trap-builder">Open Trap Builder</button>
          </div>

      {{/each}}
      </div>

  </section>


<!-- ACTORS TAB -->
<section class="tab-content tab-content wb-page-container" data-tab="actors" style="display: none;">
  <h3>Actors</h3>
  <button class="add-actor">Add Actor</button>

  <!-- Actor List -->
  <div class="actor-list">
    {{#each actors}}
      <div class="actor-builder-ui" data-index="{{@index}}">
        <form class="actor-builder-form">
          <h3>Name and Culture</h3>
          <!-- Name Input -->
          <div class="form-group">
            <table class="actor-details-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Sex / Culture</th>
                  <th></th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <!-- Name Input -->
                  <td>
                    <label for="name-input-{{@index}}" class="visually-hidden"></label>
                    <input type="text" id="name-input-{{@index}}" value="{{this.name}}" data-index="{{@index}}" placeholder="Enter Name">
                  </td>

                  <!-- Culture Selection -->
                  <td>
                    <label for="culture-select-{{@index}}" class="visually-hidden"></label>
                    <select id="culture-select-{{@index}}" class="culture-select" data-index="{{@index}}">
                      <option value="" disabled selected>Select Culture</option>
                      <!-- Cultures will be populated dynamically -->
                    </select>
                  </td>

                  <!-- Actions -->
                  <td>
                    <button type="button" class="generate-name" data-index="{{@index}}">Generate Name</button>
                  </td>
                  <td>
                    <button type="button" class="delete-actor" data-index="{{@index}}">Delete Actor</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Race Selection -->
          <h3>Race and Class</h3>
          <div class="form-group">
            <table class="actor-data-table">
              <thead>
                <tr>
                  <th>Race</th>
                  <th>Class 1</th>
                  <th>Class 2</th>
                  <th>Class 3</th>
                  <th>Background</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <!-- Race Selection -->
                  <td>
                    <select id="race-select-{{@index}}" class="race-select" data-index="{{@index}}">
                      <option value="" disabled selected>Select Race</option>
                      <!-- Races will be populated dynamically -->
                    </select>
                  </td>

                  <!-- Class Selection -->
                  <td>
                    <select id="class-select-1-{{@index}}" class="class-select" data-index="{{@index}}" data-class-index="1">
                      <option value="none" {{#if (eq this.class1.uuid "none")}}selected{{/if}}>None</option>
                      {{#each ../classData}}
                        <option value="{{this.uuid}}" {{#if (eq ../../class1.uuid this.uuid)}}selected{{/if}}>{{this.name}}</option>
                      {{/each}}
                    </select>
                  </td>

                  <td>
                    <select id="class-select-2-{{@index}}" class="class-select" data-index="{{@index}}" data-class-index="2">
                      <option value="none" {{#if (eq this.class2.uuid "none")}}selected{{/if}}>None</option>
                      {{#each ../classData}}
                        <option value="{{this.uuid}}" {{#if (eq ../../class2.uuid this.uuid)}}selected{{/if}}>{{this.name}}</option>
                      {{/each}}
                    </select>
                  </td>

                  <td>
                    <select id="class-select-3-{{@index}}" class="class-select" data-index="{{@index}}" data-class-index="3">
                      <option value="none" {{#if (eq this.class3.uuid "none")}}selected{{/if}}>None</option>
                      {{#each ../classData}}
                        <option value="{{this.uuid}}" {{#if (eq ../../class3.uuid this.uuid)}}selected{{/if}}>{{this.name}}</option>
                      {{/each}}
                    </select>
                  </td>

                  <!-- Background Selection -->
                  <td>
                    <select id="background-select-{{@index}}" class="background-select" data-index="{{@index}}">
                      <option value="" disabled selected>Select Background</option>
                      {{#each ../backgroundData}}
                        <option value="{{this.uuid}}" {{#if (eq ../../background.uuid this.uuid)}}selected{{/if}}>{{this.name}}</option>
                      {{/each}}
                    </select>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

<!-- Ability Scores Section -->
<div class="ability-scores">
  <h3>Ability Scores</h3>

  <!-- Roll Method Buttons -->
  <div class="form-group">
    <table class="roll-method-buttons">
      <tr>
        <td><button type="button" id="roll-dmchoice-{{@index}}" class="roll-method-button" data-index="{{@index}}" data-method="dmchoice">DM's Option</button></td>
        <td><button type="button" id="roll-method1-{{@index}}" class="roll-method-button" data-index="{{@index}}" data-method="method1">Method I</button></td>
        <td><button type="button" id="roll-method2-{{@index}}" class="roll-method-button" data-index="{{@index}}" data-method="method2">Method II</button></td>
        <td><button type="button" id="roll-method3-{{@index}}" class="roll-method-button" data-index="{{@index}}" data-method="method3">Method III</button></td>
        <td><button type="button" id="roll-method4-{{@index}}" class="roll-method-button" data-index="{{@index}}" data-method="method4">Method IV</button></td>
        <td><button type="button" id="roll-method5-{{@index}}" class="roll-method-button" data-index="{{@index}}" data-method="method5">Method V</button></td>
        <td><button type="button" id="roll-method6-{{@index}}" class="roll-method-button" data-index="{{@index}}" data-method="method6">Method VI</button></td>
      </tr>
    </table>
  </div>

  <!-- Ability Scores Table -->
  <table class="ability-scores-table">
    <thead>
      <tr>
        <th>Ability</th>
        <th>Assigned</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      {{#each abilities}}
      <tr>
        <td>{{@key}}</td>
        <td>
          <div id="assigned-score-{{@../index}}-{{@key}}" class="assigned-score drop-zone" data-index="{{@../index}}" data-ability="{{@key}}"></div>
        </td>
        <td>
          <span id="total-score-{{@../index}}-{{@key}}" class="ability-total">{{this}}</span>
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>

  <!-- Rolled Results -->
  <div id="roll-container-{{@index}}" class="roll-container">
    <!-- Dynamically filled with dice groups -->
  </div>
</div>





          <!-- Equipment Section -->
          <h3>Equipment</h3>
          <div class="form-group">
            <label for="equipment-select-{{@index}}">Equipment Package:</label>
            <select id="equipment-select-{{@index}}" data-index="{{@index}}">
              <option value="" disabled selected>Select Equipment Package</option>
              <option value="warrior" {{#if (eq this.equipmentPackage "warrior")}}selected{{/if}}>Warrior</option>
              <option value="paladin" {{#if (eq this.equipmentPackage "paladin")}}selected{{/if}}>Paladin</option>
              <option value="wizard" {{#if (eq this.equipmentPackage "wizard")}}selected{{/if}}>Wizard</option>
              <option value="priest" {{#if (eq this.equipmentPackage "priest")}}selected{{/if}}>Priest</option>
              <option value="druid" {{#if (eq this.equipmentPackage "druid")}}selected{{/if}}>Druid</option>
              <option value="rogue" {{#if (eq this.equipmentPackage "rogue")}}selected{{/if}}>Rogue</option>
              <option value="bard" {{#if (eq this.equipmentPackage "bard")}}selected{{/if}}>Bard</option>
            </select>
            <button type="button" class="build-equipment" data-index="{{@index}}">Build Equipment</button>
          </div>

          <!-- Generated Equipment -->
          <div class="generated-equipment">
            <table id="equipment-table-{{@index}}">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Quantity</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Populated dynamically -->
              </tbody>
            </table>
          </div>
        </form>
      </div>
    {{/each}}
  </div>
</section>


  </form>

  <!-- FOOTER -->
<footer class="save-entry wb-general-footer">
      <div class="form-actions">
          <button type="button" class="save-entry wb-subfooter">
          <i class="fas fa-save"></i> Save
          </button>
          <button type="button" class="create-journal wb-subfooter">
          <i class="fas fa-book"></i> Create Journal Entry
          </button>
      </div>  
</footer>

